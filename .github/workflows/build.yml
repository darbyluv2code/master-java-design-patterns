name: Build

on:
  push:
    branches: [ main, master ]

jobs:
  build-02-creational:
    name: "Section 02: Creational Design Patterns (5 projects)"
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25'
        distribution: 'temurin'
        cache: 'maven'

    - name: Build all projects in section
      run: |
        set -e
        echo "Building Section 02: Creational Design Patterns"
        find section-02-creational-design-patterns -name pom.xml -not -path "*/target/*" | sort | while read pom; do
          echo "Building $(dirname $pom)"
          mvn clean compile -B -q -f "$pom" || {
            echo "Failed to compile $pom"
            exit 1
          }
        done
        echo "Section 02 completed successfully"

  build-03-structural:
    name: "Section 03: Structural Design Patterns (5 projects)"
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25'
        distribution: 'temurin'
        cache: 'maven'

    - name: Build all projects in section
      run: |
        set -e
        echo "Building Section 03: Structural Design Patterns"
        find section-03-structural-design-patterns -name pom.xml -not -path "*/target/*" | sort | while read pom; do
          echo "Building $(dirname $pom)"
          mvn clean compile -B -q -f "$pom" || {
            echo "Failed to compile $pom"
            exit 1
          }
        done
        echo "Section 03 completed successfully"

  build-04-behavioral:
    name: "Section 04: Behavioral Design Patterns (11 projects)"
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25'
        distribution: 'temurin'
        cache: 'maven'

    - name: Build all projects in section
      run: |
        set -e
        echo "Building Section 04: Behavioral Design Patterns"
        find section-04-behavioral-design-patterns -name pom.xml -not -path "*/target/*" | sort | while read pom; do
          echo "Building $(dirname $pom)"
          mvn clean compile -B -q -f "$pom" || {
            echo "Failed to compile $pom"
            exit 1
          }
        done
        echo "Section 04 completed successfully"
